# SBUS 协议分析器

一个专为Futaba SBUS信号设计的Python3协议分析工具，集成了SBUS协议解析和数据记录功能，支持电平取反的硬件实现。

## 功能特性

- 🔍 自动连接SBUS串口（100000波特率）
- 📡 实时解析SBUS数据帧（25字节）
- 🎛️ 显示16个模拟通道数据（PWM值：1000-2000us）
- 🔢 显示2个数字通道状态（CH17, CH18）
- 📊 监控帧丢失和故障保护状态
- 📝 数据记录到CSV文件
- 🕐 带时间戳的完整数据记录
- ⚡ 支持电平取反硬件实现

## 环境设置（使用Miniconda）

### 1. 创建虚拟环境
```bash
conda create -n serial_debug python=3.11 -y
```

### 2. 激活虚拟环境
```bash
conda activate serial_debug
```

### 3. 安装依赖
```bash
pip install pyserial
```

## 使用方法

1. 激活虚拟环境：
```bash
conda activate serial_debug
```

2. 运行程序：
```bash
python sbus_analyzer.py
```

3. 按照菜单提示操作：
   - 选择 `9` 设置串口号（如COM1, COM2, COM3等）
   - 选择 `1` 连接SBUS串口（100000波特率）
   - 选择 `2` 开始实时监控SBUS数据
   - 选择 `4` 开始记录数据到CSV文件
   - 选择 `6` 显示当前通道数据

## SBUS串口参数

- **波特率**: 100000 bps（固定）
- **数据位**: 8位
- **停止位**: 2位
- **校验位**: 偶校验（Even Parity）
- **电平取反**: 硬件实现（已集成）

## SBUS协议规格

### 数据帧结构
- **帧长度**: 25字节
- **起始字节**: 0x0F
- **结束字节**: 0x00
- **数据通道**: 16个模拟通道（11位分辨率）
- **数字通道**: 2个数字通道（CH17, CH18）
- **状态位**: 帧丢失、故障保护

### 通道数据范围
- **PWM范围**: 1000-2000微秒
- **SBUS范围**: 172-1811（11位）
- **无效值**: 0（表示通道未使用）

### 数据记录格式
CSV文件包含以下字段：
- 时间戳、帧计数、错误计数
- 16个模拟通道数据（ch1-ch16）
- 2个数字通道状态（ch17, ch18）
- 帧丢失和故障保护状态

## 注意事项

1. 确保串口设备已正确连接到计算机
2. 检查设备管理器中的COM端口号
3. 某些串口可能需要管理员权限
4. 使用Ctrl+C可以安全退出程序

## 故障排除

### 连接问题
- **连接失败**: 检查串口是否被其他程序占用
- **权限错误**: 尝试以管理员身份运行
- **串口不存在**: 检查设备管理器中的COM端口号

### SBUS数据问题
- **无数据接收**: 确认SBUS信号源正常工作
- **数据解析错误**: 检查SBUS帧格式和电平取反电路
- **帧丢失**: 检查信号质量和连接稳定性
- **故障保护**: 确认遥控器信号正常

### 记录功能问题
- **CSV文件无法创建**: 检查文件写入权限
- **数据记录中断**: 确保监控功能正常运行

## 系统要求

- Windows 10/11
- Python 3.6+
- pyserial库
